<div class="row">
    <div class="col">
        <div class="tooltip-container">
            <button class="btn btn-primary rounded-circle" (click)="actualize()" ><i class="fa-solid fa-arrows-rotate"></i></button>
            <div class="tooltip">Actualiser la table des fichiers</div>
        </div>
    </div>
    <div class="col">
        <div *ngFor="let key of progression | keyvalue">
            <div class="row" *ngIf="key.value != 0">
                <div class="col-md-8">
                    Téléchargement en cours : {{ key.value }}%
                </div>
                <div class="col">
                    <progress max="100" [value]="key.value" class="w-100"></progress>
                </div>
            </div>
        </div>                      
    </div>
    <div class="col-md-3">
        <input type="text" class="form-control rounded-0" placeholder="Recherche.." [(ngModel)]="searchTerm">
    </div>
</div>

<div *ngIf="isLoading ; else content">
    <!-- Afficher le loader ici -->
    <div class="loader"></div>
</div>
<ng-template #content>
    <table class="table mt-3">
        <thead>
            <tr>
                <th>Date :</th>
                <th>Fichier :</th>
                <th>Taille :</th>
                <th>Catégorie :</th>
                <th>Modifier</th>
                <th>Télécharger</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let file of filteredfiles">
                <td>{{file.createdAt | date: 'dd/MM/yyyy'}}</td>
                <td><a [href]="readFile(file.fileName)" target="_blank">{{file.fileName.length > 40 ? file.fileName.substr(14,40)+'..': file.fileName.substr(14,39)}}</a></td>
                <td>{{file.fileSizeFormatted}}</td>
                <td>{{file.fileCategory}}</td>
                <td><button (click)="openDialog(file._id)" style="width: 30px; height: 30px; box-shadow: 5px 5px 5px rgba(0, 0, 0, 0.1); padding: 3px;" class="btn btn-primary rounded-circle"><i class="fa-regular fa-pen-to-square"></i></button></td>
                <td><a style="cursor: pointer;" (click)="downloadFile(file._id,file.fileName)">télécharger&nbsp;&nbsp;<i style="color:rgb(121, 21, 21); font-size: 20px;" class="fa-solid fa-circle-down"></i></a></td>
            </tr>
        </tbody>
    </table>
</ng-template>

<div class="message-dialog" [class.open]="isDialogOpen">
    <div class="message-content">
    <h5 class="mb-3">Modifier la catégorie</h5>
    <div class="row mb-3">
        <div class="col">
            <select class="form-control" name="fileCategory" [(ngModel)]="fileForm.fileCategory">
                <option value="" disabled selected hidden>Choisissez une catégorie</option>
                <option value="ECG">ECG</option>
                <option value="ETT">ETT</option>
                <option value="Radiographie">Radiographie</option>
                <option value="Tomodensitométrie (CT)">Tomodensitométrie (CT)</option>
                <option value="Imagerie par résonance magnétique (IRM)">Imagerie par résonance magnétique (IRM)</option>
                <option value="Échographie">Échographie</option>
                <option value="Mammographie">Mammographie</option>
                <option value="Endoscopie">Endoscopie</option>
                <option value="Scintigraphie">Scintigraphie</option>
                <option value="Angiographie">Angiographie</option>
                <option value="Électroencéphalogramme (EEG)">Électroencéphalogramme (EEG)</option>
                <option value="Ponction lombaire (PL)">Ponction lombaire (PL)</option>
                <option value="Tests de fonction pulmonaire">Tests de fonction pulmonaire</option>
                <option value="Bilans sanguins et d'urine">Bilans sanguins et d'urine</option>
                <option value="Rapports d'imagerie médicale avancée">Rapports d'imagerie médicale avancée</option>
                <option value="Cartes d'implants médicaux">Cartes d'implants médicaux</option>
                <option value="Rapports opératoires">Rapports opératoires</option>
            </select> 
        </div>
    </div>
    <div class="row">
        <div class="col">
            <button class="btn btn-primary rounded-0" (click)="updateFileCategory()">Modifier</button>
        </div>
        <div class="col">
            <button class="btn btn-secondary rounded-0" (click)="closeMessageDialog()">Fermer</button>
        </div>
    </div>
    </div>
</div>